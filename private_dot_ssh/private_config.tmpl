# config --- ssh client configuration

# Mike Barker <mike@thebarkers.com>
# October 9th, 2017

## History:
# 2024-03-08
# * Moved into chezmoi as template, os specific settings now in the template
# 2024-03-04
# * Changes to allow tailscale subnet routing to work when 'ssh'ing to hosts.
# 2023-09-05
# * Add devhost -> vm-debian11-02
# 2023-04-27
# * Remove all hosts IdentityFile
# * Rename public keys to use <key name>-<generated at>.pub
#   So: id_ed25519-1password.pub is a key generated by 1password
# * Add IdentityFile to those hosts that use them
# 2023-03-22
# * Add rule to use my op_ed25519.pub key from 1Password
# * Major reorder and cleanup
# 2024-02-23 MRB
# * Oops, the file should be formated with entries that are most specific to
#   least specific, so the 'Host *' should be at the end of the file.
# * Add vm-debian12-*
# * Change comments to use one # not two
# * Add devbox host
# * Reorg the ds1, dsm, sr1 and srm hosts
# * Remove laptops
# * Change name of include file to 'config-os'

# External hosts and services
Host github.com
    IdentityFile ~/.ssh/id_ed25519-1p_github.pub

# Cloudflare tunneled hosts
Host gitlab-ssh.thebarkers.com
    ProxyCommand cloudflared access ssh --hostname %h

# Proxmox virtual machines
Host mediabox
    HostName mediabox.home.thebarkers.com
    IdentityFile ~/.ssh/id_ed25519-1p_mike.pub
    User media
Host vm-debian11-01
    HostName vm-debian11-01.home.thebarkers.com
    IdentityFile ~/.ssh/id_ed25519-1p_archon.pub
    User archon
Host vm-debian12-01
    HostName vm-debian12-01.home.thebarkers.com
    IdentityFile ~/.ssh/id_ed25519-1p_archon.pub
    User archon

# My Proxmox virtual machines
Host devbox
    HostName vm-debian12-01.home.thebarkers.com
    IdentityFile ~/.ssh/id_ed25519-1p_mike.pub
    User mike

# Synology hosts
Host ds1 dsm sr1 srm
    IdentityFile ~/.ssh/id_ed25519-1p_mike.pub
    Port 10022
Host ds1 dsm
    HostName ds1.home.thebarkers.com
    User admin_dsm
Host sr1 srm
    HostName sr1.home.thebarkers.com
    User root

# Proxmox hosts (Supermicro)
Host sm*
    IdentityFile ~/.ssh/id_ed25519-1p_mike.pub
    User root

# All hosts
Host *
    Protocol 2
    ServerAliveInterval 60
    ServerAliveCountMax 30
    IdentitiesOnly yes
    # automatically load keys into ssh-agent
    AddKeysToAgent yes
    # Automatically forward ssh-agent to destination
    ForwardAgent yes
{{- if -eq .chezmoi.os "darwin" }}
    # 1Password identity agent
    IdentityAgent "~/.1password/agent.sock"
{{- elseif -eq .chezmoi.os "windows" }}
{{- elseif -eq .chezmoi.os "linux" }}
    # 0Password identity agent
    IdentityAgent "~/.1password/agent.sock"
{{- end }}
